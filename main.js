(()=>{"use strict";var e=function(e,t){e.classList.remove(t.errorActiveClass),e.textContent=""},t=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0};function n(t,n){t.querySelectorAll(n.inputSelector).forEach((function(o){var r=t.querySelector(n.errorSelectorFactory(o));e(r,n),o.setCustomValidity("")}))}function o(e){e.classList.remove("popup_is-opened"),e.closePopupCallback&&e.closePopupCallback(),e.keydownHandler&&(document.removeEventListener("keydown",e.keydownHandler),e.keydownHandler=null)}function r(e){e.openPopupCallback&&e.openPopupCallback(),e.classList.add("popup_is-opened"),e.keydownHandler=function(t){return function(e,t){"Escape"===e.key&&o(t)}(t,e)},document.addEventListener("keydown",e.keydownHandler)}function c(e,t){t.addEventListener("click",(function(t){r(e)}))}function a(e,t,n){var o=e.querySelector(".card__image"),r=e.querySelector(".card__title"),c=e.querySelector(".card__like-counter"),a=e.querySelector(".card__delete-button"),u=e.querySelector(".card__like-button");o.src=t.link,o.alt=t.alt,r.textContent=t.name,c.textContent=t.likes.length,t.likes.some((function(e){return e._id===n._id}))?(t.liked=!0,u.classList.add("card__like-button_is-active")):(t.liked=!1,u.classList.remove("card__like-button_is-active")),t.owner._id!==n._id?a.classList.add("card__delete-button_not-active"):a.classList.remove("card__delete-button_not-active")}var u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-30",headers:{authorization:"c4d399cf-fb22-4310-a840-55b74a384927","Content-Type":"application/json"}},i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return fetch("".concat(u.baseUrl,"/").concat(e),{method:t,headers:u.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},l=function(){return i("users/me","GET")},d=document.querySelector(".profile__edit-button"),s=document.querySelector(".popup_type_edit"),p=document.querySelector(".popup_type_edit .popup__button"),f=document.querySelector(".profile__add-button"),_=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_new-card .popup__button"),v=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_update_avatar"),S=document.querySelector(".popup_type_update_avatar .popup__button"),k=document.querySelector(".profile__image_edit_button"),b=document.querySelectorAll(".popup");c(_,f),c(s,d),c(y,k),b.forEach((function(e){e.classList.add("popup_is-animated"),e.querySelector(".popup__close").addEventListener("click",(function(t){o(e)})),e.addEventListener("click",(function(t){t.target===e&&o(e)}))}));var q=document.querySelector(".places__list"),h=document.querySelector("#card-template").content.querySelector(".card"),C=v.querySelector(".popup__caption"),E=v.querySelector(".popup__image");function g(e,t){return function(e,t,n,o,c){var u=e.cloneNode(!0),l=u.querySelector(".card__image"),d=u.querySelector(".card__delete-button"),s=u.querySelector(".card__like-button");return a(u,t,n),d.addEventListener("click",(function(){return function(e,t){var n;(n=t._id,i("cards/".concat(n),"DELETE")).then((function(){e.remove()})).catch((function(e){console.log(e)}))}(u,t)})),s.addEventListener("click",(function(){return c(u,t)})),l.addEventListener("click",(function(){return function(e,t){C.textContent=t.name,E.src=t.link,E.alt=t.alt,r(v)}(0,t)})),u}(h,e,t,0,(function(e,n){var o;(n.liked?(o=n._id,i("cards/likes/".concat(o),"DELETE")):function(e){return i("cards/likes/".concat(e),"PUT")}(n._id)).then((function(o){n.liked=!n.liked,a(e,o,t)})).catch((function(e){console.log(e)}))}))}function L(e,t){e.append(t)}Promise.all([i("cards","GET"),l()]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){var t=g(e,n);L(q,t)})),D(n.name,n.about),j(n.avatar)})).catch((function(e){console.log(e)}));var P=document.forms["edit-profile"],w=P.querySelector('input[name="name"]'),x=P.querySelector('input[name="description"]'),T=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),H=document.querySelector(".profile__image");function D(e,t){T.textContent=e,A.textContent=t}function j(e){H.style.backgroundImage="url(".concat(e,")")}function F(e,t){e.textContent=t?e.dataset.readyText:e.dataset.processingText}P.addEventListener("submit",(function(e){e.preventDefault();var t=w.value,n=x.value;F(p,!1),function(e,t){return i("users/me","PATCH",{name:e,about:t})}(t,n).then((function(e){D(e.name,e.about),o(s),P.reset()})).catch((function(e){console.log(e)})).finally((function(){F(p,!0)}))})),s.openPopupCallback=function(){w.value=T.textContent,x.value=A.textContent,n(P,N)},s.closePopupCallback=function(){P.reset()};var M=document.forms["new-place"],U=M.querySelector('input[name="place-name"]'),V=M.querySelector('input[name="link"]');M.addEventListener("submit",(function(e){e.preventDefault();var t,n=U.value,r={name:n,link:V.value,alt:n};F(m,!1),Promise.all([(t=r,i("cards","POST",t)),l()]).then((function(e){var t=g(e[0],e[1]);L(q,t),o(_),M.reset()})).catch((function(e){console.log(e)})).finally((function(){F(m,!0)}))})),_.closePopupCallback=function(){M.reset(),n(M,N)};var B=document.forms["update-avatar"],G=B.querySelector('input[name="avatar"]');B.addEventListener("submit",(function(e){e.preventDefault();var t,n=G.value;F(S,!1),(t=n,i("users/me/avatar","PATCH",{avatar:t})).then((function(e){j(e.avatar),o(y),B.reset()})).catch((function(e){console.log(e)})).finally((function(){F(S,!0)}))})),y.openPopupCallback=function(){var e;G.value=(e=H.style.backgroundImage).slice(5,e.length-2),n(B,N)},y.closePopupCallback=function(){B.reset()};var I,N={formSelector:".popup__form",errorActiveClass:"popup__input_error_active",inputSelector:".popup__input",submitButtonSelector:".popup__button",errorSelectorFactory:function(e){return".popup__".concat(e.id,"_error")}};I=N,document.querySelectorAll(I.formSelector).forEach((function(n){var o=Array.from(n.querySelectorAll(I.inputSelector)),r=n.querySelector(I.submitButtonSelector);t(o,r),o.forEach((function(c){var a=n.querySelector(I.errorSelectorFactory(c));c.addEventListener("input",(function(n){c.validity.patternMismatch?c.setCustomValidity(c.dataset.errorMessage):c.setCustomValidity(""),c.validity.valid?e(a,I):function(e,t,n){e.textContent=t,e.classList.add(n.errorActiveClass)}(a,c.validationMessage,I),t(o,r)}))}))}))})();